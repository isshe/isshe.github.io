<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>网络协议 on 树深时间录</title><link>https://isshe.site/categories/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/</link><description>Recent content in 网络协议 on 树深时间录</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Sun, 12 Dec 2021 16:13:02 +0000</lastBuildDate><atom:link href="https://isshe.site/categories/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/index.xml" rel="self" type="application/rss+xml"/><item><title>ARP 协议介绍</title><link>https://isshe.site/p/arp-%E5%8D%8F%E8%AE%AE%E4%BB%8B%E7%BB%8D/</link><pubDate>Sun, 12 Dec 2021 16:13:02 +0000</pubDate><guid>https://isshe.site/p/arp-%E5%8D%8F%E8%AE%AE%E4%BB%8B%E7%BB%8D/</guid><description>ARP协议 ARP（Address Resolution Protocol）：地址解析协议，是根据IP地址获取物理地址的一个TCP/IP协议。
工作过程 当主机A要与主机B通信时，地址解析协议可以将主机B的IP地址解析成主机B的MAC地址(如果A/B不同网段，则A解析的应该是下一跳的MAC地址)，以下为工作流程：
第1步：主机A根据路由表内容，确定用于访问主机B的转发IP地址。主机A在本地ARP缓存中查找与主机B的IP匹配MAC地址。 第2步：如果主机A没有找到映射，则将ARP请求帧广播到本地网络上的所有主机。 收到请求的主机检查自己的IP是否匹配，不匹配就丢弃此ARP请求。 第3步：主机B确定ARP请求中的IP地址与自己的IP地址匹配，则将主机A的IP地址和MAC地址映射添加到本地ARP缓存中。 第4步：主机B将包含其MAC地址的ARP回复消息直接发送回主机A。 第5步：当主机A收到从主机B发来的ARP回复消息时，会用主机B的IP和MAC地址映射更新ARP缓存。本机缓存是有生存期的，生存期结束后，将再次重复上面的过程。主机B的MAC地址一旦确定，主机A就能向主机B发送IP通信了。 问题 什么是ARP欺骗？ 地址解析协议是建立在网络中各个主机可互相信任的基础上的，收到应答报文的主机，不会校验报文的真实性，就会加到ARP缓存中。 由此，攻击者可以向某一主机发送伪ARP应答报文，使此主机发送的信息无法到达预期的主机或者到达错误的主机，这就是ARP欺骗。</description></item><item><title>DHCP 协议介绍</title><link>https://isshe.site/p/dhcp-%E5%8D%8F%E8%AE%AE%E4%BB%8B%E7%BB%8D/</link><pubDate>Sun, 12 Dec 2021 16:13:02 +0000</pubDate><guid>https://isshe.site/p/dhcp-%E5%8D%8F%E8%AE%AE%E4%BB%8B%E7%BB%8D/</guid><description>DHCP DHCP - 动态主机设置协议（Dynamic Host Configuration Protocol）。 DHCP是一个应用层协议。基于UDP。
作用 用于内网或网络服务供应商自动分配IP给用户。 作为内部管理员对所有计算机进行中央管理的手段。 历史 DHCP在1993年10月成为标准协议，它的前身是BOOTP协议。 BOOTP：BOOTP是一种网络协议，让电脑或其他周边仪器可以从服务器下载启动程序。 数据包类型 DHCP发现（DISCOVER）：client在物理子网上发送广播来寻找可用的服务器。 DHCP提供（OFFER）：当DHCP服务器收到一个来自客户的IP租约请求时，它会提供一个IP租约。 DHCP请求（REQUEST）：当客户PC收到一个IP租约提供时，它必须告诉所有其他的DHCP服务器它已经接受了一个租约提供。 DHCP确认（Acknowledge，ACK）：确认租约，包含租期和客户可能请求的其他所有配置信息。 DHCP释放(RELEASE)：客户端向DHCP服务器发送一个请求以释放DHCP资源，并注销其IP地址。 DHCP NAK：服务器回复客户，客户要求的网址不能被分配。 原理/流程 客户主机发送DHCP服务器发现(DISCOVER)广播包。 服务器收到DISCOVER包后，回复OFFER单播或广播包。【疑问？】 客户主机收到OFFER包后，发送REQUEST广播包。 服务器回复ACK单播或广播包。包含分配的IP及网关IP(next server IP)、租约等。 典型DHCP会话的模式
协议结构 +-------+--------+--------+--------+ |8 bits | 8 bits | 8 bits | 8 bits | +-------+--------+--------+--------+ | Op | Htype | Hlen | Hops | +-------+--------+--------+--------+ | Xid | +----------------------------------+ | Secs | Flags | +----------------+-----------------+ | Ciaddr | +----------------------------------+ | Yiaddr | +----------------------------------+ | Siaddr | +----------------------------------+ | Giaddr | +----------------------------------+ | Chaddr (16 bytes) | +----------------------------------+ | Sname (64 bytes) | +----------------------------------+ | File (128 bytes) | +----------------------------------+ | Option (variable) | +----------------------------------+ Op: 信息类型。如：客户端请求为1，服务器回复为2。 Htype：硬件类型。如：Ethernet(0x01) Hlen: 硬件地址长度。如：6。（MAC地址） Hops: 跳数。 Xid：传输ID。 Secs: 过去的时间。【疑问】 Flags：标记。 Ciaddr：客户端IP地址。（这里应该是续约的时候用的） Siaddr：下一个服务器IP地址。 Yiaddr：你的IP。（分配给客户机的IP） Giaddr：中继代理IP。【？？？】 Chaddr：客户机硬件地址。（Ethernet中就是Mac地址） Sname：服务器主机名称。 File：文件名。 Options：选项。详见rfc2132 1：子网掩码； 3：路由(网关)； 12：主机名 50：请求的IP地址 51：租约时间 53：DHCP消息类型。即上面的几种类型。 54：服务器标识。 疑问 DHCP服务器是否可以把一台主机拉黑？ 这个应该由DHCP软件提供。 服务器回复为什么是单播或广播包？ Flags中设置BROADCAST = 0时，则是单播；否则是广播。这是为了健壮性，同时兼容单播和多播。 Secs字段是哪一个时间段？ 从获取到IP地址或者续约过程开始到现在所消耗的时间。 Giaddr字段作用是什么？ giaddr: 中继代理地址。 中继代理相关详见：博客 相关 DHCP: RFC 2131 DHCP6: RFC 3315 DHCP wiki DHCP wiki中文 rfc2132</description></item><item><title>DNS 协议介绍</title><link>https://isshe.site/p/dns-%E5%8D%8F%E8%AE%AE%E4%BB%8B%E7%BB%8D/</link><pubDate>Sun, 12 Dec 2021 16:13:02 +0000</pubDate><guid>https://isshe.site/p/dns-%E5%8D%8F%E8%AE%AE%E4%BB%8B%E7%BB%8D/</guid><description>DNS DNS - 域名系统（Domain Name System）。
是一个将域名和IP地址进行映射的分布式数据库。 DNS是应用层协议，使用TCP和UDP的53端口。 每一级域名长度的限制是63个字符，域名总长度不能超过253个字符。 作用 将对人友好的域名转换为对计算机友好的IP地址。 原理/过程 域名层级
主机名.次级域名.顶级域名.根域名 host.sld.tld.root www.isshe.xyz.root abc.isshe.xyz.root 分级查询：从根域名开始，依次查询每一级域名的NS记录。
从根域名服务器查询顶级域名服务器的NS记录和A记录； 根域名服务器是总所周知的，不用查。 从顶级域名服务器查询次级域名服务器的NS记录和A记录； 从次级域名服务器查询主机名的A记录； 分级查询示例：www.isshe.xyz
dig +trace www.isshe.xyz 进行查看
列出根域名服务器： . 227343 IN NS e.root-servers.net. . 227343 IN NS k.root-servers.net. . 227343 IN NS i.root-servers.net. . 227343 IN NS d.root-servers.net. . 227343 IN NS j.root-servers.net. . 227343 IN NS m.</description></item><item><title>ICMP 协议介绍</title><link>https://isshe.site/p/icmp-%E5%8D%8F%E8%AE%AE%E4%BB%8B%E7%BB%8D/</link><pubDate>Sun, 12 Dec 2021 16:13:02 +0000</pubDate><guid>https://isshe.site/p/icmp-%E5%8D%8F%E8%AE%AE%E4%BB%8B%E7%BB%8D/</guid><description>[TOC]
ICMP ICMP - 互联网控制消息协议（Internet Control Message Protocol） ICMP是互联网协议族的核心协议之一。 IMCP用于发送控制消息，提供可能发生在通信环境中的各种问题反馈。 ICMP消息都是直接封装在一个IP数据包中的，因此，和UDP一样，ICMP是不可靠的。 原理及技术细节 每个路由器在转发数据报的时候都会把IP包头中的TTL值减1。 报文结构 ICMP报头从IP报头的第160位(20字节)开始：（有可选部分另算）
8bit 8bit 8bit 8bit +------+------+------+------+ | Type | Code | Checksum | +------+------+------+------+ | ID | Sequence | +------+------+------+------+ Type: ICMP报文类型。 Code：进一步划分ICMP的类型；该字段用来查找产生错误的原因。 例如，ICMP的目标不可达类型可以把这个位设为1至15等来表示不同的意思。 Checksum：校验和。 ID：ID/标识，在Echo Reply类型的消息中需要返回这个字段。 Sequence：序号，在Echo Reply类型的消息中需要返回这个字段。 报文类型 Type Code Status 描述 查询 差错 备注 0：Echo响应 0 Echo响应 ✓ ping中使用 1 未分配 ✓ 保留 2 未分配 ✓ 保留 3：目的不可达 0 目标网络不可达 ✓ 1 目标主机不可达 ✓ 2 目标协议不可达 ✓ 3 目标端口不可达 ✓ 4 要求分段并(但)设置DF标记 ✓ 5 源路由失败 ✓ 6 未知的目标网络 ✓ 7 未知的目标主机 ✓ 8 源主机隔离（作废不用） ✓ 9 禁止访问的网络 ✓ 10 禁止访问的主机 ✓ 11 对特定的TOS 网络不可达 ✓ 12 对特定的TOS 主机不可达 ✓ 13 由于过滤 网络流量被禁止 ✓ 14 主机越权 ✓ 15 优先权终止生效 ✓ 4：源端关闭 0 弃用 源端关闭（拥塞控制） ✓ 5：重定向 0 重定向网络 ✓ 1 重定向主机 ✓ 2 基于TOS的网络重定向 ✓ 3 基于TOS的主机重定向 ✓ 6 弃用 备用主机地址 7 未分配 保留 8 0 Echo请求 ✓ 9 0 路由通告 ✓ 10 0 路由器的发现/选择/请求 ✓ 11：超时 0 TTL超时 ✓ 1 分片重组超时 ✓ 12：参数问题-IP头部错误 0 IP报文首部参数错误 ✓ 1 丢失必要选项 ✓ 2 不支持的长度 13 0 时间戳请求 ✓ 14 0 时间戳应答 ✓ 15 0 信息请求 ✓ 16 0 信息应答 ✓ 17 0 地址掩码请求 ✓ 18 0 地址掩码应答 ✓ 19 保留 因安全原因保留 20~29 保留 保留用于稳健性实验 30~39 弃用 40 Photuris, Security failures ？？？ 41 用于实验性移动协议，如Seamoby[RFC4065] 42~255 保留 235 实验性 RFC3692 254 实验性 RFC3692 部分报文结构示例 3：目标不可达 目的地不可达由主机或其入站网关生成，以通知客户端由于某种原因目的地不可达。</description></item><item><title>VLAN 介绍</title><link>https://isshe.site/p/vlan-%E4%BB%8B%E7%BB%8D/</link><pubDate>Sun, 12 Dec 2021 16:13:02 +0000</pubDate><guid>https://isshe.site/p/vlan-%E4%BB%8B%E7%BB%8D/</guid><description>VLAN VLAN - 虚拟局域网（Virtual Local Area Network）。 在IEEE 802.1Q中，给定以太网上的最大VLAN数为4094。（12位VID。减去头尾的0和4095）
作用 VLAN可以为网络提供以下作用： 广播控制 带宽利用 降低延迟 安全性（非设计作用，本身功能所附加出的） 采用虚拟局域网技术实现交换机以太网的广播隔离。 一个VLAN相当于OSI模型第2层的广播域，它能将广播控制在一个VLAN内部。 不同VLAN之间或VLAN与LAN/WAN的数据通信必须通过第3层（网络层）完成。 原理（划分方式） 物理层(physical layer) 以交换机端口作为划分VLAN的基础。 适合规模不大的组织。 数据链路层(data link layer) 以每台主机的MAC地址作为划分VLAN的基础。 实现方法： 创建一个MAC与VLAN映射的数据库。 当网络设备连接到端口后，交换机向VMPS(VLAN管理策略服务器)请求这个数据库。 找到相应的映射，完成VLAN的分配。 优点： 计算机物理位置的不同，也不影响VLAN的运作。 缺点： 人为建立MAC与VLAN的映射关系；因此导致管理复杂度增加。 网络层 以IP地址作为划分VLAN的基础；以子网视为VLAN设置的依据。【？？？】 优点： 网管人员已经将内部网段做好规划与分配后，将可大辐降低规划并设置VLANs架构的复杂度。 缺点： 交换机需要对帧进行处理（原本不需要），降低交换机接收和分派分组的效率。</description></item></channel></rss>